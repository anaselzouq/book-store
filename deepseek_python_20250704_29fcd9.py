import os
import requests
from bs4 import BeautifulSoup
from urllib.parse import quote

# قائمة بجميع عناوين الكتب العربية
arabic_titles = [
    'أن تكون عباس العبد', 'أرض زيكولا', 'خوف', 'في قلبي أنثى عبرية', 'أنتيخريستوس',
    'نطفة', 'شآبيب', 'النبطي', 'موسم الهجرة إلى الشمال', 'عائد إلى حيفا',
    'رجال في الشمس', 'ثلاثية غرناطة', 'رأيت رام الله', 'بيت الأرواح', 'الفيل الأزرق',
    'هيبتا', 'فرج', 'كحل وحبهان', 'كلب بلدي', 'جنة وأخواتها',
    'طوق الحمام', 'اللص والكلاب', 'زقاق المدق', 'بين القصرين', 'قنديل أم هاشم',
    'حديث الصباح والمساء', 'السمان والخريف', 'السكرية', 'الحرافيش', 'رحلة ابن فطومة',
    'عدوية', 'رائحة القرفة', 'فوضى الحواس', 'ذاكرة الجسد', 'نسيان.com',
    'ساق البامبو', 'خيط حرير', 'أرض الإله', 'أنتيخريستوس 2', 'ملكوت هذه الأرض',
    'ساعة بغداد', 'عتمة الذاكرة', 'كويكول', 'الأسود يليق بك', 'الخطايا العشر',
    'رجل المستحيل', 'ملائك نصيبين', 'مقتل الرجل الكبير', 'سقوط الأقنعة', 'عصر الحب',
    'ذات', 'عمارة يعقوبيان', 'فردقان', 'واحة الغروب', 'أبو عمر المصري',
    'شيكاغو', 'يوتوبيا', 'إيكادولي', 'لا تقرب النساء قبل سن الخامسة والعشرين', 'حديث القمر',
    'قواعد العشق الأربعون', 'الطريق', 'حكايات فرغلي المستكاوي', 'يحدث ليلاً في الغرفة المغلقة', 'توأم الروح',
    'الحب في المنفى', 'أنثى السراب', 'العودة إلى الطفولة', 'تغريبة القافر', 'قصة حب مجوسية',
    'التبر', 'مرافئ الوهم', 'الوجه الآخر', 'حرمة', 'الفتى المتيم والمعلمة',
    'الأنثى المقدسة', 'بيت من زجاج', 'ليل التكايا', 'نساء عاشقات', 'ورود سامة لصقر',
    'الفردوس المستعار', 'سيدة المقام', 'ما رواه البحر', 'غواية التشابه', 'صاحب الظل الطويل',
    'الأبله', 'الشحاذ', 'المرايا', 'عالم صوفي', 'دعاء الكروان',
    'قصة مدينتين', 'صانع الظلام', 'سر الغرفة 207', 'أنين الذاكرة', 'بعد منتصف الليل',
    'رماد الشرق', 'أرض السافلين', 'ظل الأفعى', 'تغريبة بني حتحوت', 'كريسماس في مكة'
]

# إنشاء مجلد لحفظ الصور
os.makedirs('book_covers', exist_ok=True)

for title in arabic_titles:
    try:
        # تشفير العنوان لاستخدامه في الرابط
        encoded_title = quote(title)
        search_url = f"https://www.noor-book.com/search?term={encoded_title}"
        
        headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
        }
        
        # إرسال طلب البحث
        response = requests.get(search_url, headers=headers)
        soup = BeautifulSoup(response.text, 'html.parser')
        
        # استخراج رابط الصورة الأول (تحديث حسب هيكل الموقع الحالي)
        img_tag = soup.find('img', {'class': 'img-fluid'})
        
        if img_tag:
            img_url = img_tag['src']
            
            # التأكد من أن الرابط كامل
            if not img_url.startswith('http'):
                img_url = 'https://www.noor-book.com' + img_url
                
            # تحميل الصورة
            img_data = requests.get(img_url, headers=headers).content
            
            # حفظ الصورة مع استبدال الأحظر غير المسموحة في أسماء الملفات
            safe_title = "".join(c for c in title if c.isalnum() or c in " -_")
            with open(f'book_covers/{safe_title}.jpg', 'wb') as handler:
                handler.write(img_data)
            print(f"تم تحميل: {title}")
        else:
            print(f"! لم يتم العثور على غلاف لـ: {title}")
            
    except Exception as e:
        print(f"حدث خطأ مع {title}: {str(e)}")

print("اكتمل تحميل الأغلفة!")